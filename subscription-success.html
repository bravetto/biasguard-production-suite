<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription Successful - BiasGuards.ai</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }
        
        .success-container {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .checkmark {
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }
        
        .tier-info {
            background: #f3f4f6;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            border-left: 4px solid #10b981;
        }
        
        .tier-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .tier-features {
            list-style: none;
            text-align: left;
        }
        
        .tier-features li {
            padding: 0.5rem 0;
            position: relative;
            padding-left: 2rem;
        }
        
        .tier-features li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
        }
        
        .trial-info {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
            color: #92400e;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #1e40af;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: transparent;
            color: #1e40af;
            border: 2px solid #1e40af;
        }
        
        .btn-secondary:hover {
            background: #1e40af;
            color: white;
        }
        
        .support-info {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e40af;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="success-container">
        <div class="success-icon">
            <span class="checkmark">‚úì</span>
        </div>
        
        <h1>Welcome to BiasGuards!</h1>
        <p class="subtitle">Your subscription has been successfully activated</p>
        
        <div class="trial-info">
            <strong>üéâ Your 14-day free trial has started!</strong><br>
            You won't be charged until your trial period ends.
        </div>
        
        <div class="tier-info" id="tier-info">
            <div class="tier-name" id="tier-name">Loading...</div>
            <ul class="tier-features" id="tier-features">
                <li><span class="loading"></span>Loading subscription details...</li>
            </ul>
        </div>
        
        <div class="action-buttons">
            <a href="/" class="btn btn-primary">
                üõ°Ô∏è Start Using BiasGuards
            </a>
            <button onclick="openCustomerPortal()" class="btn btn-secondary" id="portal-btn">
                ‚öôÔ∏è Manage Subscription
            </button>
        </div>
        
        <div class="support-info">
            <p><strong>Need help?</strong> Contact us at support@biasguards.ai</p>
            <p>Your subscription supports JAHmere Webb's legal defense and criminal justice reform.</p>
        </div>
    </div>

    <script>
        // Get session ID and tier from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');
        const tier = urlParams.get('tier') || 'starter';
        
        // Store customer info for future use
        if (sessionId) {
            localStorage.setItem('stripe_session_id', sessionId);
            localStorage.setItem('subscription_tier', tier);
        }
        
        // Define tier information
        const tierInfo = {
            starter: {
                name: 'Starter Plan - $19/mo',
                features: [
                    'Basic bias detection analysis',
                    '1,000 analyses per month',
                    'Email support',
                    'Justice mission support (15% of revenue)',
                    'Access to core bias detection features'
                ]
            },
            professional: {
                name: 'Professional Plan - $99/mo',
                features: [
                    'Advanced bias detection analysis',
                    'Counterfactual analysis',
                    '10,000 analyses per month',
                    'Priority support',
                    'API access',
                    'Advanced reporting',
                    'Justice mission support (15% of revenue)'
                ]
            },
            enterprise: {
                name: 'Enterprise Plan - $299/mo',
                features: [
                    'Full bias detection suite',
                    'Neural howlround prevention',
                    'Unlimited analyses',
                    'Custom integration support',
                    'Dedicated account manager',
                    'White-label options',
                    'Priority feature requests',
                    'Justice mission support (15% of revenue)'
                ]
            }
        };
        
        // Update tier information
        function updateTierInfo() {
            const info = tierInfo[tier] || tierInfo.starter;
            const tierNameEl = document.getElementById('tier-name');
            const tierFeaturesEl = document.getElementById('tier-features');
            
            tierNameEl.textContent = info.name;
            tierFeaturesEl.innerHTML = info.features
                .map(feature => `<li>${feature}</li>`)
                .join('');
        }
        
        // Open customer portal for subscription management
        async function openCustomerPortal() {
            const portalBtn = document.getElementById('portal-btn');
            const originalText = portalBtn.innerHTML;
            
            portalBtn.innerHTML = '<span class="loading"></span>Opening Portal...';
            portalBtn.disabled = true;
            
            try {
                // This would need the customer ID from the session
                // For now, we'll redirect to the main page where they can access it
                alert('Customer portal will be available once you complete your first analysis. This will link your account with your subscription.');
                window.location.href = '/';
            } catch (error) {
                console.error('Failed to open customer portal:', error);
                alert('Unable to open customer portal. Please try again later.');
            } finally {
                portalBtn.innerHTML = originalText;
                portalBtn.disabled = false;
            }
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateTierInfo();
            
            // Track successful subscription
            if (typeof gtag !== 'undefined') {
                gtag('event', 'purchase', {
                    'event_category': 'subscription',
                    'event_label': tier,
                    'value': tier === 'starter' ? 19.99 : tier === 'professional' ? 99 : 299
                });
            }
            
            // Show success message after a short delay
            setTimeout(() => {
                console.log('üéâ Subscription successful for tier:', tier);
            }, 1000);
        });
        
        // Auto-redirect to main app after 30 seconds if user doesn't interact
        setTimeout(() => {
            if (confirm('Ready to start using BiasGuards? Click OK to continue or Cancel to stay on this page.')) {
                window.location.href = '/';
            }
        }, 30000);
    </script>
</body>
</html>